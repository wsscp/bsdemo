CREATE OR REPLACE 
PROCEDURE "SAVE_PRODUCT_WEIGHT_BY_WONO" (WORKORDERNO IN VARCHAR2, WEIGHT IN VARCHAR2,CHECKITEMCODE IN VARCHAR2, CREATER IN VARCHAR2)
AS

	VAR_CONTRACT_NO 		T_PLA_ORDER_TASK.CONTRACT_NO%TYPE;
	VAR_SALES_ORDER_ID		T_ORD_SALES_ORDER_ITEM.ID%TYPE;
	VAR_SALES_ORDER_NO 		T_PRO_PROCESS_QC_VALUE.SALES_ORDER_NO%TYPE;
	VAR_CUSTOMER_ORDER_NO 	T_PRO_PROCESS_QC_VALUE.CUSTOMER_ORDER_NO%TYPE;
	VAR_CUST_PRODUCT_TYPE 	T_ORD_SALES_ORDER_ITEM.CUST_PRODUCT_TYPE%TYPE;
	VAR_CUST_PRODUCT_SPEC 	T_ORD_SALES_ORDER_ITEM.CUST_PRODUCT_SPEC%TYPE;
	VAR_PRODUCT_CODE 		T_PRO_PROCESS_QC_VALUE.PRODUCT_CODE%TYPE;
	VAR_PRODUCT_TYPE 		T_PRO_PROCESS_QC_VALUE.PRODUCT_TYPE%TYPE;
	VAR_PRODUCT_SPEC 		T_PRO_PROCESS_QC_VALUE.PRODUCT_SPEC%TYPE;
	VAR_PROCESS_CODE		T_PRO_PROCESS_QC_VALUE.PROCESS_CODE%TYPE;
	VAR_CRAFTS_ID			T_PRO_PROCESS_QC_VALUE.CRAFTS_ID%TYPE;
	VAR_PROCESS_ID			T_PRO_PROCESS_QC_VALUE.PROCESS_ID%TYPE;
	VAR_EQIP_CODE			T_PRO_PROCESS_QC_VALUE.EQIP_CODE%TYPE;
	
	
	NOW CONSTANT TIMESTAMP:=SYSDATE;
	
	CURSOR mycursor IS 
	SELECT 
		OT.CONTRACT_NO,
		OSOI.SALES_ORDER_ID,
		OSOI.CUST_PRODUCT_TYPE,
    	OSOI.CUST_PRODUCT_SPEC,
		OT.PRODUCT_CODE,
		OT.PROCESS_ID,
		OT.EQUIP_CODE
  	FROM T_ORD_SALES_ORDER_ITEM OSOI
  	LEFT JOIN T_PLA_CUSTOMER_ORDER_ITEM PCOI
    ON OSOI.ID = PCOI.SALES_ORDER_ITEM_ID
  	LEFT JOIN T_PLA_CUSTOMER_ORDER_ITEM_DEC PCOID
    ON PCOID.ORDER_ITEM_ID = PCOI.ID
	LEFT JOIN T_PLA_CU_ORDER_ITEM_PRO_DEC PCOIPD
    ON PCOIPD.ORDER_ITEM_DEC_ID = PCOID.ID
	LEFT JOIN T_PLA_ORDER_TASK OT
    ON OT.ORDER_ITEM_PRO_DEC_ID = PCOIPD.ID
	WHERE OT.WORK_ORDER_NO = WORKORDERNO;

BEGIN
	OPEN mycursor;
	LOOP
	FETCH mycursor 
	INTO	VAR_CONTRACT_NO,
			VAR_SALES_ORDER_ID,
			VAR_CUST_PRODUCT_TYPE,
			VAR_CUST_PRODUCT_SPEC,
			VAR_PRODUCT_CODE,
			VAR_PROCESS_ID,
			VAR_EQIP_CODE;
	EXIT WHEN mycursor%NOTFOUND;
		IF VAR_PROCESS_ID IS NOT NULL AND VAR_PROCESS_ID != ''  THEN
			SELECT 
				T.PROCESS_CODE,
				T.PRODUCT_CRAFTS_ID
			INTO VAR_PROCESS_CODE,VAR_CRAFTS_ID
			FROM T_PRO_PRODUCT_PROCESS T 
			WHERE T.ID=VAR_PROCESS_ID;	
			
			SELECT 
				T.PRODUCT_TYPE,
				T.PRODUCT_SPEC
			INTO VAR_PRODUCT_TYPE,VAR_PRODUCT_SPEC
			FROM T_PLA_PRODUCT T
			WHERE T.PRODUCT_CODE=VAR_PRODUCT_CODE;
			
			INSERT INTO T_PRO_PROCESS_QC_VALUE(
				ID,       
				CONTRACT_NO,   
				SALES_ORDER_NO, 
				CUSTOMER_ORDER_NO, 
				CUST_PRODUCT_TYPE, 
				CUST_PRODUCT_SPEC, 
				PRODUCT_CODE, 
				PRODUCT_TYPE, 
				PRODUCT_SPEC, 
				WORK_ORDER_NO, 
				CRAFTS_ID,   
				PROCESS_ID,   
				PROCESS_CODE,
				CHECK_ITEM_CODE,
				EQIP_CODE,
				QC_VALUE,
				CREATE_USER_CODE,
				CREATE_TIME,
				MODIFY_USER_CODE,
				MODIFY_TIME
			)VALUES(
				SYS_GUID(),
				VAR_CONTRACT_NO,   
				VAR_SALES_ORDER_NO, 
				VAR_CUSTOMER_ORDER_NO, 
				VAR_CUST_PRODUCT_TYPE, 
				VAR_CUST_PRODUCT_SPEC, 
				VAR_PRODUCT_CODE, 
				VAR_PRODUCT_TYPE, 
				VAR_PRODUCT_SPEC, 
				WORKORDERNO, 
				VAR_CRAFTS_ID,   
				VAR_PROCESS_ID,   
				VAR_PROCESS_CODE,
				CHECKITEMCODE,
				VAR_EQIP_CODE,
				WEIGHT,
				CREATER, 
				NOW, 
				CREATER, 
				NOW
			);
		END IF;
	END LOOP;
	CLOSE mycursor;
END;
